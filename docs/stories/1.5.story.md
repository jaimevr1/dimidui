# Story 1.5: Dashboard do Aluno e Persistência de Dados

- **Status**: Draft
- **Epic**: 1
- **Release**: 1.0

## Story
As a: Aluno,
I want: Ver minhas atividades no dashboard e ter meu progresso salvo,
so that: Eu possa continuar de onde parei e acompanhar meu desempenho.

## Acceptance Criteria
1.  A página `aluno-dashboard.html` deve buscar e listar as atividades atribuídas ao aluno logado.
2.  Ao completar uma questão, o `activity-runtime.js` deve salvar os dados da tentativa (acerto, erro, tempo) na tabela `student_attempts`.
3.  O dashboard deve refletir o status das atividades (ex: concluída, a fazer).

## Dev Notes

### Fluxo de Dados do Dashboard
O script do dashboard (`dashboard.js`) será executado no carregamento da página `aluno-dashboard.html`. Ele deve primeiro verificar se o usuário está logado (usando o `student_id` do `localStorage`). Em seguida, ele fará uma chamada ao Supabase para buscar as atividades da tabela `activity_assignments` que correspondem ao ID do aluno.

- **Fonte**: `docs/architecture/6-frontend-architecture.md#62-routing-architecture`

### Persistência de Dados
A persistência deve ocorrer em tempo real ou o mais próximo disso. Cada vez que o aluno responde a uma questão dentro de um módulo, o `activity-runtime.js` deve construir um objeto de dados da tentativa e enviá-lo para a tabela `student_attempts` no Supabase. Isso garante que o progresso não seja perdido, mesmo que o aluno saia no meio de uma atividade.

- **Fonte**: `docs/architecture/5-database-schema.md` (Tabela `student_attempts`)

### Estrutura de Dados
- Para buscar as atividades, será necessário fazer um `join` implícito ou duas queries: uma para `activity_assignments` para obter os `activity_id` e outra para `activities` para obter os detalhes de cada atividade.
- O objeto a ser salvo em `student_attempts` deve conter todos os campos relevantes, como `student_id`, `activity_id`, `module_index`, `questions_data`, etc.

- **Fonte**: `docs/architecture/4-data-models-typescript-interfaces.md`

## Tasks / Subtasks

1.  **Implementar a Busca de Atividades no Dashboard (AC: 1)**
    - [ ] Crie o arquivo `/scripts/dashboard.js` e inclua-o em `aluno-dashboard.html`.
    - [ ] No script, obtenha o `student_id` do `localStorage`.
    - [ ] Use o cliente Supabase para buscar todas as entradas em `activity_assignments` onde `student_id` corresponde.
    - [ ] Com a lista de `activity_id`s, faça uma segunda busca na tabela `activities` para obter os detalhes de cada atividade.
    - [ ] Crie uma função para renderizar cada atividade como um card no HTML, exibindo o nome, tipo e duração estimada.
    - [ ] Cada card de atividade deve ser um link para `atividade.html?id=<activity_id>`.

2.  **Implementar a Persistência de Tentativas (AC: 2)**
    - [ ] Modifique o `activity-runtime.js`.
    - [ ] Após cada resposta do aluno, dentro da lógica de tentativa, crie um objeto com os dados da tentativa.
    - [ ] Use o cliente Supabase para inserir (`.insert()`) um novo registro na tabela `student_attempts` com os dados coletados.
    - [ ] Certifique-se de incluir `student_id` (do `localStorage`), `activity_id` (da atividade carregada), o índice do módulo e os detalhes da questão.

3.  **Exibir Status da Atividade no Dashboard (AC: 3)**
    - [ ] Modifique o `/scripts/dashboard.js`.
    - [ ] Antes de renderizar os cards de atividade, faça uma busca na tabela `student_attempts` para verificar quais atividades já foram concluídas (`completed_at` não é nulo) pelo aluno.
    - [ ] Ao renderizar os cards, adicione um indicador visual (ex: um ícone de check ✅ ou uma classe CSS diferente) para as atividades que já foram concluídas.

4.  **Verificação Manual**
    - [ ] Atribua manualmente 2-3 atividades a um usuário de teste no Supabase (inserindo registros em `activity_assignments`).
    - [ ] Faça login como esse usuário e verifique se as atividades atribuídas aparecem no dashboard.
    - [ ] Complete uma das atividades.
    - [ ] Volte para o dashboard e verifique se a atividade completada agora tem um indicador de status "concluída".
    - [ ] Verifique no painel do Supabase se os registros de tentativa foram salvos corretamente na tabela `student_attempts`.
