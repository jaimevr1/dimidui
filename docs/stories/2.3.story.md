# Story 2.3: Integração do Banco de Questões e Preview

- **Status**: Draft
- **Epic**: 2
- **Release**: 1.0

## Story
As a: Professor,
I want: Adicionar módulos à minha atividade, usando questões do banco ou criando novas na hora,
so that: Eu possa montar a sequência pedagógica desejada.

## Acceptance Criteria
1.  Na interface de criação de atividade, ao adicionar um módulo, deve haver a opção "Usar do Banco de Questões".
2.  Uma modal deve permitir a seleção de questões do banco.
3.  A interface deve permitir a criação de novas questões "on-the-fly".
4.  Deve haver um modo de "Preview" que mostra a sequência de módulos antes de salvar a atividade.

## Dev Notes

### Fluxo de Adição de Módulo
Esta estória conecta as duas anteriores. A página `professor-criar.html` será expandida. O botão "+ Adicionar Módulo" agora abrirá uma modal. Essa modal apresentará ao professor a escolha: criar uma questão do zero ou selecionar uma do banco. A questão selecionada ou criada será então adicionada à "esteira" da atividade que está sendo construída.

- **Fonte**: `docs/dimidui_spec.md#5-interface-criação-de-atividade` (Wireframe)

### Modal de Seleção
A modal para "Usar do Banco de Questões" (AC: 2) deve ser uma interface de busca e seleção. Ela pode listar todas as questões do banco, talvez com filtros por tipo de módulo ou tags, permitindo que o professor escolha uma ou mais questões para adicionar à atividade.

### Preview (AC: 4)
O modo de preview pode ser simples. Ao clicar no botão "Preview", o sistema pode renderizar uma versão simplificada e somente leitura da atividade em uma nova aba ou em uma modal, usando o mesmo `activity-runtime.js` da visão do aluno, mas sem a lógica de salvar as tentativas.

## Tasks / Subtasks

1.  **Implementar a Modal de Adição de Módulo (AC: 1)**
    - [ ] Modifique o script `/scripts/activity-creator.js`.
    - [ ] Adicione um event listener ao botão "+ Adicionar Módulo".
    - [ ] Ao ser clicado, o listener deve abrir uma modal.
    - [ ] A modal deve conter duas opções principais: "Criar Nova Questão" e "Usar do Banco de Questões".

2.  **Integrar o Banco de Questões (AC: 2)**
    - [ ] Se o professor clicar em "Usar do Banco de Questões", a modal deve fazer uma chamada ao Supabase para buscar os itens da `question_bank`.
    - [ ] Renderize os itens em uma lista selecionável (com checkboxes).
    - [ ] Adicione um botão "Adicionar Selecionadas" à modal.
    - [ ] Ao clicar, o script deve pegar as questões selecionadas, formatá-las como módulos de atividade (com `type` e `config`) e adicioná-las a um array que representa a atividade sendo criada.

3.  **Integrar Criação "On-the-fly" (AC: 3)**
    - [ ] Se o professor clicar em "Criar Nova Questão", a modal deve apresentar o mesmo formulário dinâmico da estória 2.2.
    - [ ] Após salvar a nova questão (que deve ser inserida na `question_bank`), o script deve automaticamente adicioná-la como um módulo à atividade que está sendo criada.

4.  **Renderizar a "Esteira" de Módulos**
    - [ ] Na página `professor-criar.html`, crie uma área (`<div id="modules-list">`) para exibir os módulos que foram adicionados à atividade.
    - [ ] Cada vez que um módulo é adicionado (seja do banco ou criado na hora), renderize um "card" para ele nesta área, mostrando um resumo do seu conteúdo e talvez um botão para removê-lo.

5.  **Implementar o Preview (AC: 4)**
    - [ ] Adicione um botão "Preview" na página.
    - [ ] Ao clicar, o script deve construir um objeto de atividade JSON completo com base nos metadados preenchidos e na lista de módulos adicionados.
    - [ ] Abra uma nova janela ou uma modal grande e passe este objeto JSON para o `activity-runtime.js` para renderizar a atividade em modo somente leitura.

6.  **Verificação Manual**
    - [ ] Abra a página de criação de atividade.
    - [ ] Clique em "+ Adicionar Módulo" e selecione "Usar do Banco de Questões". Verifique se as questões criadas na estória anterior são listadas.
    - [ ] Selecione algumas questões e adicione-as. Verifique se elas aparecem na página principal.
    - [ ] Adicione outro módulo, desta vez criando uma nova questão. Verifique se ela é adicionada à lista.
    - [ ] Clique em "Preview" e confirme que a sequência de módulos é renderizada corretamente em modo de visualização.
